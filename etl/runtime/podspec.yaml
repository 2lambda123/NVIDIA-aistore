apiVersion: v1
kind: Pod
metadata:
  name: <NAME>
spec:
  containers:
    - name: server
      image: aistore/runtime_python:<TAG>
      imagePullPolicy: IfNotPresent
      ports:
        - name: default
          containerPort: 80
      command: <COMMAND>
      env:
        - name: MOD_NAME
          value: code
        - name: FUNC_FILTER
          value: <FUNC_FILTER>
        - name: FUNC_BEFORE
          value: <FUNC_BEFORE>
        - name: FUNC_TRANSFORM
          value: <FUNC_TRANSFORM>
        - name: FUNC_AFTER
          value: <FUNC_AFTER>
        - name: COMM_TYPE
          value: <COMM_TYPE>
        - name: CHUNK_SIZE
          value: <CHUNK_SIZE>
        - name: PYTHONPATH
          value: /runtime
      readinessProbe:
        httpGet:
          path: /health
          port: default
      volumeMounts:
        - name: code
          mountPath: "/code"
        - name: runtime
          mountPath: "/runtime"
  initContainers:
    - name: server-deps
      image: aistore/runtime_python:<TAG>
      imagePullPolicy: IfNotPresent
      command:
        - 'sh'
        - '-c'
        - |
          echo "${AISTORE_CODE}" > /dst/code.py
          echo "${AISTORE_DEPS}" > /dst/requirements.txt
          pip install --target="/runtime" -r /dst/requirements.txt
      volumeMounts:
        - name: code
          mountPath: "/dst"
        - name: runtime
          mountPath: "/runtime"
  volumes:
    - name: code
      emptyDir: {}
    - name: runtime
      emptyDir: {}
